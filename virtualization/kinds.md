# 仮想化ソフトウェアの種類　何使うの

仮想化にはホスト型、ハイパーバイザ型、コンテナ型の３種類がある。

## ホスト型
- ホストOSとゲストOSとの間でシームレスな運用
- ホストOSがクラッシュすると巻き込まれる
- ホストOSを介してのハードウェアリソースのアクセスを行うと余分なオーバーヘッドが生じる
- 数台程度の仮想マシンしか提供できない
- 個人の検証・ 開発
- PCの中にもう一つのPCを設置する

## ハイパーバイザ型　準仮想化
- ハードウェアに直接インストールする
- ハードウェア仮想化に特化したカーネルを持つものが多く(VMware Hypervisorなど) 良好なパフォーマンスを得られ
- 数十台の仮想マシンを提供可能
- スケーラビリティに優れる
- インストール可能なハードウェアが制限される(モノリシック型の場合)
- デバイスへのアクセスが管理OSに集中し、仮想化システム全体のパフォーマンスが悪化する可能性がある(マイクロカーネル型の場合)
- チームでの検証・開発 サーバの運用

## コンテナ型
- 起動が高速なので急な負荷上昇時に迅速にスケールアウトでき
- 機動的なキャパシティ制御(リソース管理)が可能。
  - ピーク負荷に備えておくために、余分に起動しておくということが不要になり得る。
  - ただし、コンテナを載せるホストには常に余剰リソースが必要。
- ローリングリスタートの仕組みが整えばデプロイがより安全になり、楽になり得る。
- 再起動に伴う性能劣化やサービス停止の考慮が不要になるため。
- アプリケーションに応じて graceful restart の仕組みを整えるという手間がなくなり得る。
- OS やパッケージの更新がより簡単に実施できるようになる可能性がある
- ホスト側の更新もより楽に
  - コンテナを別ホストに引っ越すことが簡単にできるシステム構成になるはず。
  - ホスト側で必要なパッケージは最低限コンテナの起動に必要なものだけになるので、多くのケースでは少なくなるだろう。

- コンテナ型仮想化環境への移行に伴うハードル
  - システムが複雑になる
  - コンテナを積むホストとコンテナを別々に管理することになる
  - ログ収集や監視、デプロイなど仕組みを整える必要がある

### ハイパバイザ型実現方法
#### 完全仮想化
- 文字通り物理マシンを完全に仮想マシンとして実現する方法
- WindowsなどのOSに手を加えることなくそのまま仮想マシンで実行することが可能である。

#### 準仮想化
- OSのカーネル内で行なれる物理マシンに対するシステムコールに手を加え、ハイパーバイザ固有の「ハイパーバイザコール」を呼び出す形に修正して実行する方法
- ハイパーバイザの機能を直接利用するため、オーバーヘッドを抑えて仮想マシンを高速に実行することができる。

### ハイパバイザ型実装方法
|タイプ|デバイスドライバの位置|仮想マシンとハードウェアのI/O処理|説明|
|:--|:--|:--|:--|
|モノリシック型|ハイパバイザ層|ハイパバイザのデバイスドライバ|ハイパーバイザ専用のドライバを開発・用意する必要がある
|マイクロカーネル型|親パーティション上の仮想マシン(管理OS)に組み込む|管理OSのデバイスドライバ（Xenのドメイン0、Hyper-VのペアレントOSがこれに該当する）|管理OSはWindowsやLinuxであるため、通常のOS用のデバイスドライバを用意するだけでそのまま利用可能になる。

## 仮想化ツールの紹介

|||
|:--|:--|
|ホスト型|- workstation(有償))<br>- VMwarePlayer(無償)<br>- Server <br>- Fusion <br>- Virtual PC(ホストOSのライセンスを持っていれば無償)<br>- Virtual Server(ホストOSのライセンスを持っていれば無償)<br>- VirtualBox
|ハイパーバイザ型|- Hypervisor(旧VMware ESX ESXi　モノリシック型)ライセンスによる <br>- Hyper-Vマイクロカーネル型 <br>- Xen(マイクロカーネル) <br>- Kernel-based Virtual Machine（KVM）
|コンテナ型|- parallels virtuozzo containers<br>- Sun Solaris Containers<br>- Linux Containers(LXC)<br>- Docker<br>- FreeBSDJail
